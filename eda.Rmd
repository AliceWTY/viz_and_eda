---
title: "Exploratory Analysis"
author: "Tianyou Wang"
date: "2022-10-11"
output: html_document
---

## *Setting Opotions*

From last lecture, in addition to figure sizing, we include a few other figure preferences in global options declared at the outset of each .Rmd file (this code chunk just gets copy-and-pasted to the beginning of every new file).

```{r setup, include=FALSE}
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```





## Load the Weather Data
`lubridate::floor_date(date, unit = "month")` round the days to the first day of the month.
```{r warning = FALSE}
weather_df =  
  rnoaa::meteo_pull_monitors(
    c("USW00094728", "USC00519397", "USS0023B17S"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2017-01-01",
    date_max = "2017-12-31") %>%
  mutate(
    name = recode(
      id, 
      USW00094728 = "CentralPark_NY", 
      USC00519397 = "Waikiki_HA",
      USS0023B17S = "Waterhole_WA"),
    tmin = tmin / 10,
    tmax = tmax / 10,
    month = lubridate::floor_date(date, unit = "month")) %>%
  select(name, id, everything())

weather_df
```





##  *`group_by`*

Datasets are often comprised of groups defined by one or more (categorical) variable; group_by() makes these groupings explicit so that they can be included in subsequent operations. For example, we might group weather_df by name, which give us 3 groups.
```{r}
weather_df %>%
  group_by(name)
```


For example, we might group weather_df by name and month, which give us 36 groups.
```{r}
weather_df %>%
  group_by(name, month)
```


We can also ungroup after we group.
```{r}
weather_df %>%
  group_by(name, month) %>% 
  ungroup(month)
```




## *Counting Things*

### `summarize()` 

We will frequently use `summarize()` to create one-number-variable that summaries within each group, or use `mutate()` to define variables within groups. 

For example, counting the number of observations in each month.
```{r}
weather_df %>%
  group_by(month) %>%
  summarize(n_obs = n())
```


*** `count()`
We can also use `count()` in place of `group_by()` and `summarize()`.
```{r}
weather_df %>%
  count(name, month, name = "n_obs")
```


**Never** use base R's `table()` function!!!
`count()` is a useful tidyverse alternative to Base R’s `table()` function. Both functions produce summaries of how often values appear (number of occurrences), but table’s output is a classic n*2 table and is hard to do any additional work with it. `count()` adds one or more numeric columns to the original data frame, which can be used or manipulated later directly. For an example, run the code below and check the classic 12-by-2 table.

```{r}
weather_df %>%
  pull(month) %>% 
  table()
```



### Other helpful counters

We can use `summarize()` to compute *multiple summaries* within each group; creating multiple numeric columns. As an example, we count the number of observations in each month and the number of distinct dates in each month.
```{r}
weather_df %>%
  group_by(month) %>%
  summarize(
    n_obs = n(),
    n_days = n_distinct(date))
```








