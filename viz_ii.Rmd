---
title: "Visualization"
subtitle: "Part II"
author: "Tianyou Wang"
date: "2022-10-11"
output: html_document
---

```{r setup}
library(tidyverse)
library(patchwork)
```

## Load the Weather Data

```{r warning = FALSE}
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728", "USC00519397", "USS0023B17S"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2017-01-01",
    date_max = "2017-12-31") %>%
  mutate(
    name = recode(
      id, 
      USW00094728 = "CentralPark_NY", 
      USC00519397 = "Waikiki_HA",
      USS0023B17S = "Waterhole_WA"),
    tmin = tmin / 10,
    tmax = tmax / 10) %>%
  select(name, id, everything())

weather_df
```



## *Labels*

Providing informative axis labels, plot titles, and captions, via `labs(title = "", x = "", y = "", caption = "")`.
```{r Warning = FALSE}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = "Temperature plot",
    x = "Minimum daily temperature (C)",
    y = "Maxiumum daily temperature (C)",
    caption = "Data from the rnoaa package; temperatures in 2017"
  )
```



## *Scales*
We can set scales for x and y axis by using `scale_x_continuous()`. We can also label them by using `labels = c()` inside of `scale_x_continuous()`.

```{r Warning = FALSE}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = "Temperature plot",
    x = "Minimum daily temperature (C)",
    y = "Maxiumum daily temperature (C)",
    caption = "Data from the rnoaa package; temperatures in 2017") + 
  scale_x_continuous(
    breaks = c(-15, 0, 15), 
    labels = c("-15ºC", "0", "15ºC")) +
  scale_y_continuous(
    trans = "sqrt",
    position = "right"
  )
```

What we did for the x, y-axis scales:

- `breaks = c()` setting the scale points, seperated by commas
- `labels = c()` choice how we label the scale points, such as adding units
- `trans = ""` is used to transform the data, such as trans = "sqrt" (square root) and trans = "log"
- `position = "right"` putting the scale discription on the right side of graph



### Color Scales
```{r Warning = FALSE}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = "Temperature plot",
    x = "Minimum daily temperature (C)",
    y = "Maxiumum daily temperature (C)",
    caption = "Data from the rnoaa package; temperatures in 2017") + 
  scale_color_hue(
    name = "Location",
    h = c(100, 300))
```

Using `name = "xxx"` to rename the coloring variance, in this case we use 
(name = "Location") to change our variable "name" to "Location". Note: the variable "name" accidentally shared the same name with the (name = "xxx") command.

The default hue is "h = c(1, 360)"



### Viridis Package for Color Scheme
Trying to create your own color scheme usually doesn’t go well. You can use the "viridis package" instead. There are several options, but the default color scheme works nicely!

Note: `viridis::scale_color_viridis()` assume the variable you put in is a continuous variable. If we are applying it to a discrete variable (this case, location,) we want to write `discrete = TRUE` inside the scale_color_viridis command.

```{r Warning = FALSE}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = "Temperature plot",
    x = "Minimum daily temperature (C)",
    y = "Maxiumum daily temperature (C)",
    caption = "Data from the rnoaa package; temperatures in 2017") + 
  viridis::scale_color_viridis(
    name = "Location",
    discrete = TRUE)
```





## *Themes*
Themes are used to modify *non-data elements of a plot*. They don’t change mappings or how data are render, but control things like background color and location of the the legend. Using themes can help with general plot appearance.

For example, the default legent position is on the right of the graphic. If we want to move it to the bottom, we can use `theme(legend.position = "bottom")`.

```{r Warning = FALSE}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = "Temperature plot",
    x = "Minimum daily temperature (C)",
    y = "Maxiumum daily temperature (C)",
    caption = "Data from the rnoaa package; temperatures in 2017") + 
  viridis::scale_color_viridis(
    name = "Location",
    discrete = TRUE) +
  theme(legend.position = "bottom")
```



Or we can name the plot and add themes.
```{r Warning = FALSE}
ggp_temp_plot =
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = "Temperature plot",
    x = "Minimum daily temperature (C)",
    y = "Maxiumum daily temperature (C)",
    caption = "Data from the rnoaa package; temperatures in 2017") + 
  viridis::scale_color_viridis(
    name = "Location",
    discrete = TRUE)
```

```{r}
ggp_temp_plot + 
  theme(legend.position = "bottom")
```



Some other theme examples:
White background with black box around.
```{r}
ggp_temp_plot + 
  theme_bw()
```


Just white background.
```{r}
ggp_temp_plot + 
  theme_minimal() +
  theme(legend.position = "bottom")

```


```{r}
ggp_temp_plot + 
  theme_classic()
```

In `ggthemes` there are a lot of themes.
```{r}
ggp_temp_plot + 
  ggthemes::theme_economist_white()
```


```{r}
ggp_temp_plot + 
  ggthemes::theme_excel()
```


```{r}
ggp_temp_plot + 
  ggthemes::theme_excel_new()
```





## Setting Opotions

In addition to figure sizing, I include a few other figure preferences in global options declared at the outset of each .Rmd file (this code chunk just gets copy-and-pasted to the beginning of every new file).

```{r eval=FALSE}
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

What we did in this code chunk:

- `opt_chunk$set()` setting the R code chunks
- `fig.width` sets the figure width
- `fig.asp` set the aspect ratio (height/width)
- `out.width` let the figure sit bit away from the margins
- `theme_set` setting the graphic themes
- setting color and fill preferences globally through `options()`



